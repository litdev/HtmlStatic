<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/mui.ext.loading.css" />
		<link rel="stylesheet" href="../css/public.css" />
		<style>
			.head-img {
				width: 90px !important;
				height: 90px;
			}
			
			.user-info {
				margin-left: 100px;
			}
			
			.user-nickname {
				height: 32px;
				display: flex;
				justify-content: space-around;
				align-items: center;
				align-content: center;
			}
			
			.user-nickname span {
				overflow: hidden;
				text-overflow: ellipsis;
			}
			
			.user-nickname img {
				width: 40px;
				height: 32px;
			}
			
			.user-qb {
				height: 50px;
				margin-top: 4px;
			}
			
			.mui-control-item {
				width: 33% !important;
			}
			
			.fixed-group-buttom {
				height: 50px;
				width: 100%;
				background: white;
				padding: 1px 10px;
				position: fixed;
				display: flex;
				z-index: 999;
				justify-content: space-between;
				align-items: center;
			}
			.js-price{
				color: #007aff;
				font-size: 18px;
			}
			.js-remark{
				font-size: 14px;
				color: rgba(0,0,0,0.7);
			}
		</style>
	</head>

	<body>
		<div class="mui-navbar-inner mui-bar mui-bar-nav">
			<button type="button" onclick="javascript:location.href='个人中心首页.html'" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav"></span>
			</button>
			<h1 class="mui-center mui-title">咨询结算</h1>
			<button type="button" onclick="location.href='咨询结算申请历史.html'" class="mui-right mui-btn  mui-btn-link mui-btn-nav mui-pull-right">
					结算历史
			</button>
		</div>

		<div class="mui-content">
			<div id="slider" class="mui-slider mui-fullscreen">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll slidertab">
						<a class="mui-control-item mui-active" href="#item1mobile">
							可结算
						</a>
						<a class="mui-control-item" href="#item2mobile">
							不可结算
						</a>
						<a class="mui-control-item" href="#item3mobile">
							已结算
						</a>
					</div>
				</div>
				<div class="mui-slider-group" style="bottom:50px;">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<!--
                                	作者：litdev@outlook.com
                                	时间：2018-03-29
                                	描述：pageIndex：当前选项卡加载到第几页数据
                                		  dataTotal:接口返回的总数据
                                		  template-id: 使用的模板ID
                                		  ajaxUrl: 请求URL
                                -->
								<ul class="mui-table-view" id="ul_kejiesuan" pageIndex='1' dataTotal='' template-id="template_kejiesuan" ajaxUrl="http://shop.model-me.cn/wxopen/VideoList?id=2">
																		
                                    	<script type="text/html" id="template_kejiesuan">
										{{each info}}
										
									<li class="mui-table-view-cell li-check" data-index="{{$index}}" data-link="http://www.baidu.com">
											<img class="mui-pull-left head-img" id="head-img" src="../img/default-avatar.jpg">
											<div class="user-info">
												<div class="user-nickname">
													<span>{{$value.name}}</span>
													<label>{{$value.gender}}</label>
													<label>￥100</label>
													<div class="mui-input-row mui-checkbox">
													    <label></label>
													    <input name="ck-jiesuan" onchange="checkChange()" class="jiesuanck" data-id="{{$index}}" value="100" type="checkbox" style="top: 0 !important;">
													</div>
												</div>
												<div class="user-qb">
													<p class='mui-ellipsis'>最新回复时间：{{$value.time}}</p>
													<p class="mui-ellipsis">
														{{if $value.is_doc}}
														我说
														{{else}}
														Ta说
														{{/if}}
														:{{$value.desc}}</p>
												</div>
											</div>
									</li>	
										
										{{/each}}
									</script>
                                    	
								</ul>
							</div>
						</div>
						
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view" id="ul_bujiesuan" pageIndex='1' dataTotal='' template-id="template_bujiesuan" ajaxUrl="http://shop.model-me.cn/wxopen/VideoList?id=2">
									
                                    	<script type="text/html" id="template_bujiesuan">                                	
								     	{{each info}}
								     	<li class="mui-table-view-cell">
								     		【不可结算】索引：{{$index + 1}},姓名：{{$value.name}},年龄：{{$value.age}}
								     	</li>
								     	{{/each}}							     	
									</script>
                                    
								</ul>
							</div>
						</div>
					</div>
					<div id="item3mobile" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view" id="ul_yijiesuan" pageIndex='1' dataTotal='' template-id="template_yijiesuan" ajaxUrl="http://shop.model-me.cn/wxopen/VideoList?id=2">
									
                                    	<script type="text/html" id="template_yijiesuan">                                	
								     	{{each info}}
								     	<li class="mui-table-view-cell">
								     		【已结算】索引：{{$index + 1}},姓名：{{$value.name}},年龄：{{$value.age}}
								     	</li>
								     	{{/each}}							     	
									</script>
                                    
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mui-bar-footer fixed-group-buttom">
			<div class="bar-left">
				选中总额:<span class="js-price">￥0</span>&nbsp;<span class="js-remark">(0项)</span>
				<input type="hidden" id="hid-js-ids" value="" />
			</div>
			<div class="bar-right">
				<button id="btn_goto" onclick="location.href='咨询结算-完毕.html'" class="mui-btn-blue">提交结算申请</button>
			</div>
		</div>
	</body>
	<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script src="../js/mui.pullToRefresh.js"></script>
		<script src="../js/mui.pullToRefresh.material.js "></script>
		<script type="text/javascript" src="../js/mui.ext.loading.js"></script>
		<script type="text/javascript" src="../js/template-web.js"></script>
		<script type="text/javascript" src="../js/public.js" ></script>
		<script>			
			mui.init();
			
			//CheckBox选中
			function checkChange()
			{
				//循环获取列表
				var select_count =$('input:checkbox:checked').length;
				var total_amount =0;
				var select_ids ="";
				$.each($('input:checkbox:checked'),function(){
					//console.log("选择了："+select_count+"个，当前选中的金额："+$(this).attr('value'));
					total_amount += parseFloat($(this).attr('value'));
					select_ids += $(this).attr('data-id')+",";
				})
				$(".js-price").text('￥'+total_amount);
				$(".js-remark").text("("+select_count+"项)");				
				if(select_ids.length>0)
				{
					select_ids = select_ids.substring(0,select_ids.length-1);
				}
				$("#hid-js-ids").val(select_ids);
				
				console.log("选中的项ID："+$("#hid-js-ids").val());
				
			}
			
						
			(function($$) {
				//阻尼系数
				var deceleration = mui.os.ios ? 0.003 : 0.0009;
				var pageSize = 2;
				var count = 0;
					
				$$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration: deceleration
				});
				
				
								
				//滑动数据初始化
				document.querySelector('.mui-slider').addEventListener('slide', function(event) {
					var ul = $('.mui-slider').find('.mui-slider-group').find('.mui-slider-item').eq(event.detail.slideNumber).find('.mui-table-view');
					var pageIndex = ul.attr('pageIndex');					
					if(pageIndex == '1') {
						var template_id = ul.attr('template-id');
						var ajaxUrl = ul.attr('ajaxUrl');
						var ul_id = ul.attr('id');
						var params_data ={"pageIndex":parseInt(pageIndex),"PageSize":pageSize};
						Ajax_Load_Pullrefresh_Data(true,ajaxUrl,params_data,ul_id,template_id,pageIndex,pageSize);
						$$('body').on('tap','a',function(){document.location.href=this.href;});
					}
					if(ul.attr('id') == 'ul_kejiesuan')
					{
						$(".fixed-group-buttom").show();
						$(".mui-slider-group").css("bottom",50);
					}else
					{
						$(".fixed-group-buttom").hide();
						$(".mui-slider-group").css("bottom",0);
					}
				});
				$$.ready(function() {
					//循环初始化所有下拉刷新，上拉加载。
					$$.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
						//加载第一个数据
						if(index == '0') {
							var ul = this.querySelector('.mui-table-view');
							var pageIndex = ul.getAttribute('pageIndex');
							var template_id = ul.getAttribute('template-id');
							var ul_id = ul.getAttribute('id');
							if(pageIndex == '1') {
								var ajaxUrl = ul.getAttribute('ajaxUrl');
								var ul_id = ul.getAttribute('id');
								var params_data ={"pageIndex":parseInt(pageIndex),"PageSize":pageSize};
								Ajax_Load_Pullrefresh_Data(true,ajaxUrl,params_data,ul_id,template_id,pageIndex,pageSize);
								$$('body').on('tap','a',function(){document.location.href=this.href;});
							}
						}

						$$(pullRefreshEl).pullToRefresh({
							down: {
								callback: function() {
									console.log('下拉刷新')
									var self = this;
									var self = this;
									var ul = self.element.querySelector('.mui-table-view');
									var pageIndex = ul.getAttribute('pageIndex');
									var template_id = ul.getAttribute('template-id');
									var ajaxUrl = ul.getAttribute('ajaxUrl');
									var ul_id = ul.getAttribute('id');
									var params_data ={"pageIndex":parseInt(pageIndex),"PageSize":pageSize};
									Ajax_Load_Pullrefresh_Data(true,ajaxUrl,params_data,ul_id,template_id,pageIndex,pageSize)
									$$('body').on('tap','a',function(){document.location.href=this.href;});
									self.endPullDownToRefresh();
									
								}
							},
							up: {
								contentrefresh: '正在加载...',
								contentnomore: '没有更多数据了',
								callback: function() {
									console.log('上拉加载数据')
									var self = this;
									var ul = self.element.querySelector('.mui-table-view');
									var pageIndex = ul.getAttribute('pageIndex');
									var template_id = ul.getAttribute('template-id');
									var ajaxUrl = ul.getAttribute('ajaxUrl');									
									var ul_id = ul.getAttribute('id');	
									var params_data ={"pageIndex":parseInt(pageIndex),"PageSize":pageSize};
									Ajax_Load_Pullrefresh_Data(false,ajaxUrl,params_data,ul_id,template_id,pageIndex,pageSize)
									var data_total = ul.getAttribute('dataTotal');
									var pullSize = data_total / 2;
									self.endPullUpToRefresh(++count > pullSize);
									$$('body').on('tap','a',function(){document.location.href=this.href;});
								}
							}
						});
					});
				});
			})(mui);

			

			var template_data = {
				info: [{
						name: "刘强 ",
						age: 23,
						gender:"男",
						is_doc:false,
						desc:"张医生啊，这可咋整啊",
						time:"2018-03-25 22:32"
					},
					{
						name: "黄冲冲 ",
						age: 26,
						gender:"女",
						is_doc:true,
						desc:"这位朋友不要激动，抽根烟压压惊先",
						time:"2018-03-23 12:22"
					},
					{
						name: "熊斌 ",
						age: 22,
						gender:"男",
						is_doc:false,
						desc:"张医生啊，你帮我看看咋回事",
						time:"2018-04-02 09:14"
					}
				]
			};	
		
		</script>

</html>